<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Master Kids - ç™¼éŸ³ç‰¹è¨“ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* APP è³ªæ„Ÿå„ªåŒ–ï¼šç¦æ­¢é¸å–èˆ‡å½ˆæ€§æ²å‹• */
        body { 
            -webkit-touch-callout: none; 
            -webkit-user-select: none; 
            overscroll-behavior: none;
            font-family: 'system-ui', -apple-system, sans-serif;
        }
        
        /* å‹•ç•«æ•ˆæœåº« */
        .correct-anim { animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .pulse-mic { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="min-h-screen flex flex-col items-center max-w-md mx-auto bg-white shadow-2xl min-h-screen relative">
        <!-- é€™è£¡æœƒç”± JavaScript å‹•æ…‹æ¸²æŸ“å…§å®¹ -->
        <div class="flex items-center justify-center h-screen text-slate-400">
            è¼‰å…¥å–®å­—åº«ä¸­...
        </div>
    </div>

    <script>
        // ==========================================
        //  å–®å­—è³‡æ–™åº« (Data Center)
        // ==========================================
        /* èªªæ˜ï¼šé€™è£¡å­˜æ”¾æ‰€æœ‰é—œå¡çš„å–®å­—ã€‚
           æ ¼å¼ï¼š{ en: "è‹±æ–‡", zh: "ä¸­æ–‡", hint: "è«§éŸ³/æ³¨éŸ³" }
           æ‚¨å¯ä»¥ä¾ç…§æ­¤æ ¼å¼ç„¡é™æ“´å……ã€‚
        */

        const WORD_DATA = {
            // Level 1: æ¯éŸ³ (Vowels)
            level1: [
                { en: "A", zh: "å­—æ¯ A", hint: "ã„Ÿ" },
                { en: "E", zh: "å­—æ¯ E", hint: "ã„§" },
                { en: "I", zh: "å­—æ¯ I", hint: "æ„›" },
                { en: "O", zh: "å­—æ¯ O", hint: "æ­" },
                { en: "U", zh: "å­—æ¯ U", hint: "å„ª" },
                { en: "Ant", zh: "èèŸ»", hint: "å®‰ ã„Š" },
                { en: "Apple", zh: "è˜‹æœ", hint: "ã„Ÿ ã„†ã„›" },
                { en: "Egg", zh: "é›è›‹", hint: "ã„Ÿ ã„" },
                { en: "Ink", zh: "å¢¨æ°´", hint: "ç¡¬ ã„" },
                { en: "Orange", zh: "æŸ³æ©™", hint: "æ­ æ½¤ æ©˜" },
                { en: "Umbrella", zh: "é›¨å‚˜", hint: "å®‰ ä¸ ç‘ æ‹‰" },
                { en: "Ice", zh: "å†°", hint: "æ„› æ­»" },
                { en: "Ear", zh: "è€³æœµ", hint: "ä¼Š çˆ¾" },
                { en: "Arm", zh: "æ‰‹è‡‚", hint: "é˜¿ ã„‡" },
                { en: "Old", zh: "è€çš„", hint: "æ­ ã„‰" }
            ],
            // Level 2: æ‹¼è®€çµ„åˆ (Phonics)
            level2: [
                { en: "Cat", zh: "è²“", hint: "ã„ã„Ÿ ã„Š" },
                { en: "Bat", zh: "è™è ", hint: "ã„…ã„Ÿ ã„Š" },
                { en: "Hat", zh: "å¸½å­", hint: "é»‘ ã„Š" },
                { en: "Dad", zh: "çˆ¸çˆ¸", hint: "çˆ¹ ã„‰" },
                { en: "Dog", zh: "ç‹—", hint: "ã„‰ã„› ã„" },
                { en: "Log", zh: "åœ“æœ¨", hint: "æ‹‰ ã„" },
                { en: "Pig", zh: "è±¬", hint: "ã„†ã„§ ã„" },
                { en: "Big", zh: "å¤§çš„", hint: "å¿… ã„" },
                { en: "Bus", zh: "å…¬è»Š", hint: "çˆ¸ æ­»" },
                { en: "Sun", zh: "å¤ªé™½", hint: "æ¡‘" },
                { en: "Hot", zh: "ç†±çš„", hint: "å“ˆ ã„Š" },
                { en: "Pot", zh: "é‹å­", hint: "æ€• ã„Š" },
                { en: "Map", zh: "åœ°åœ–", hint: "å¦¹ ã„†" },
                { en: "Cap", zh: "é´¨èˆŒå¸½", hint: "ã„ã„Ÿ ã„†" },
                { en: "Bed", zh: "åºŠ", hint: "è² ã„‰" }
            ],
            // Level 3: åœ‹å°å–®å­— (Elementary)
            level3: [
                { en: "Book", zh: "æ›¸", hint: "å¸ƒ ã„" },
                { en: "Pen", zh: "ç­†", hint: "å™´" },
                { en: "Desk", zh: "æ›¸æ¡Œ", hint: "çˆ¹ æ­» ã„" },
                { en: "School", zh: "å­¸æ ¡", hint: "æ­» å“­ å–”" },
                { en: "Teacher", zh: "è€å¸«", hint: "æ¢¯ å€ å…’" },
                { en: "Student", zh: "å­¸ç”Ÿ", hint: "æ­» ä¸Ÿ ç­‰ ã„Š" },
                { en: "Boy", zh: "ç”·å­©", hint: "æ³¢ ã„§" },
                { en: "Girl", zh: "å¥³å­©", hint: "è‘› å–”" },
                { en: "Good", zh: "å¥½çš„", hint: "å¤ ã„‰" },
                { en: "Bad", zh: "å£çš„", hint: "è² ã„‰" },
                { en: "Happy", zh: "å¿«æ¨‚", hint: "é»‘ çš®" },
                { en: "Sad", zh: "é›£é", hint: "å¡ ã„‰" },
                { en: "Red", zh: "ç´…è‰²", hint: "ç‘ ã„‰" },
                { en: "Blue", zh: "è—è‰²", hint: "å¸ƒ é­¯" },
                { en: "One", zh: "ä¸€", hint: "è¬" }
            ],
            // Level 4: åœ‹ä¸­å–®å­— (Junior High)
            level4: [
                { en: "Family", zh: "å®¶åº­", hint: "è‚¥ éº¼ é›¢" },
                { en: "Friend", zh: "æœ‹å‹", hint: "å¤« ç‘ æ© ã„‰" },
                { en: "Market", zh: "å¸‚å ´", hint: "ç½µ ã„ã„§ ã„Š" },
                { en: "Dinner", zh: "æ™šé¤", hint: "æ»´ å‘¢" },
                { en: "Subject", zh: "ç§‘ç›®/ä¸»é¡Œ", hint: "è–© ã„… å‚‘ ã„ ã„Š" },
                { en: "History", zh: "æ­·å²", hint: "é»‘ æ­» ç‰¹ ç‘" },
                { en: "Music", zh: "éŸ³æ¨‚", hint: "è¬¬ å¸Œ ã„" },
                { en: "Sport", zh: "é‹å‹•", hint: "æ­» æ³¢ ã„Š" },
                { en: "Health", zh: "å¥åº·", hint: "é»‘ ã„› æ­»" },
                { en: "Doctor", zh: "é†«ç”Ÿ", hint: "æ‰“ ã„ ç‰¹" },
                { en: "Nurse", zh: "è­·å£«", hint: "è¨¥ æ­»" },
                { en: "Police", zh: "è­¦å¯Ÿ", hint: "æ³¢ éº— æ­»" },
                { en: "Money", zh: "éŒ¢", hint: "åª½ å°¼" },
                { en: "Phone", zh: "é›»è©±", hint: "é³³" },
                { en: "Watch", zh: "æ‰‹éŒ¶/çœ‹", hint: "æŒ– å»" }
            ],
            // Level 5: é«˜ä¸€å–®å­— (Senior High 1)
            level5: [
                { en: "Ability", zh: "èƒ½åŠ›", hint: "é˜¿ ç•¢ æ¨‚ è¸¢" },
                { en: "Abroad", zh: "åœ‹å¤–", hint: "é˜¿ å¸ƒ è‹¥ ã„‰" },
                { en: "Accept", zh: "æ¥å—", hint: "å™ ã„™ã„Ÿ ã„† ã„Š" },
                { en: "Active", zh: "æ´»èºçš„", hint: "ã„Ÿ ã„ è¸¢ å¤«" },
                { en: "Adult", zh: "æˆäºº", hint: "å™ å¤§ ã„› ã„Š" },
                { en: "Affect", zh: "å½±éŸ¿", hint: "å™ è² ã„ ã„Š" },
                { en: "Advice", zh: "å»ºè­°", hint: "å™ ã„‰ ã„ˆã„Ë‹ æ­»" },
                { en: "Career", zh: "è·æ¶¯", hint: "å¯ ç‘ å…’" },
                { en: "Create", zh: "å‰µé€ ", hint: "å¯ ç‘ ã„Ÿ ã„Š" },
                { en: "Damage", zh: "æå®³", hint: "çˆ¹ ç±³ å±…" },
                { en: "Debate", zh: "è¾¯è«–", hint: "åº• è² ã„Š" },
                { en: "Degree", zh: "å­¸ä½/åº¦æ•¸", hint: "åº• æ¡‚" },
                { en: "Detect", zh: "åµæ¸¬", hint: "åº• æ³° ã„ ã„Š" },
                { en: "Device", zh: "è£ç½®", hint: "åº• ã„ˆã„Ë‹ æ­»" },
                { en: "Effect", zh: "æ•ˆæœ", hint: "ä»¥ è² ã„ ã„Š" }
            ],
            // Level 6: é«˜äºŒå–®å­— (Senior High 2)
            level6: [
                { en: "Abandon", zh: "æ”¾æ£„", hint: "å™ ç­ é “" },
                { en: "Absolute", zh: "çµ•å°çš„", hint: "è‰¾ ã„… æœ é­¯ ã„Š" },
                { en: "Academic", zh: "å­¸è¡“çš„", hint: "è‰¾ å¡ çˆ¹ ç±³ ã„" },
                { en: "Access", zh: "å­˜å–/é€šé“", hint: "è‰¾ ã„ ã„™ã„Ÿ æ­»" },
                { en: "Achieve", zh: "é”æˆ", hint: "å™ å€ å¤«" },
                { en: "Benefit", zh: "åˆ©ç›Š", hint: "è² å‘¢ è²» ã„Š" },
                { en: "Capture", zh: "æ•æ‰", hint: "å‡± æ™® å€ å…’" },
                { en: "Caution", zh: "å°å¿ƒ", hint: "è€ƒ ç‚«" },
                { en: "Collapse", zh: "å€’å¡Œ", hint: "å¯ è³´ æ™® æ­»" },
                { en: "Combine", zh: "çµåˆ", hint: "åº· æ‹œ æ©" },
                { en: "Concept", zh: "æ¦‚å¿µ", hint: "åº· ã„™ã„Ÿ ã„† ã„Š" },
                { en: "Decade", zh: "åå¹´", hint: "çˆ¹ ã„ã„Ÿ ã„‰" },
                { en: "Decline", zh: "è¡°é€€/æ‹’çµ•", hint: "åº• å…‹ è³´ æ©" },
                { en: "Dynamic", zh: "å‹•æ…‹çš„", hint: "å¸¶ å¥ˆ ç±³ ã„" },
                { en: "Economy", zh: "ç¶“æ¿Ÿ", hint: "ä»¥ åº· è«¾ ç±³" }
            ],
            // Level 7: æ—¥å¸¸ç”¨èª (Daily Life)
            level7: [
                { en: "Hello", zh: "ä½ å¥½", hint: "å“ˆ å›‰" },
                { en: "Goodbye", zh: "å†è¦‹", hint: "å¤ æ°" },
                { en: "Please", zh: "è«‹", hint: "æ™® éº— æ­»" },
                { en: "Thanks", zh: "è¬è¬", hint: "æ•£ ã„ æ­»" },
                { en: "Sorry", zh: "å°ä¸èµ·", hint: "ç¸® ç‘" },
                { en: "Help", zh: "å¹«å¿™", hint: "é»‘ ã„› ã„†" },
                { en: "Water", zh: "æ°´", hint: "ç“¦ ç‰¹" },
                { en: "Food", zh: "é£Ÿç‰©", hint: "å¤« ã„‰" },
                { en: "Toilet", zh: "å»æ‰€", hint: "å· ä¸€ å‹’ ã„Š" },
                { en: "Sleep", zh: "ç¡è¦º", hint: "æ­» éº— ã„†" },
                { en: "Wait", zh: "ç­‰ä¸€ä¸‹", hint: "å¨ ã„Š" },
                { en: "Excuse me", zh: "ä¸å¥½æ„æ€", hint: "ä»¥ ã„ æ­» ï¼± æ­» å¯†" },
                { en: "How much", zh: "å¤šå°‘éŒ¢", hint: "è±ª ç½µ å–" },
                { en: "Where", zh: "åœ¨å“ªè£¡", hint: "å¨ å…’" },
                { en: "When", zh: "ä½•æ™‚", hint: "æº«" }
            ],
            // Level 8: æ–‡æ³•/å‹•è©è®ŠåŒ– (Grammar/Verbs)
            level8: [
                { en: "Do", zh: "åš (åŸå½¢)", hint: "åº¦" },
                { en: "Did", zh: "åš (éå»å¼)", hint: "å¼Ÿ ã„‰" },
                { en: "Done", zh: "åš (å®Œæˆå¼)", hint: "ç•¶" },
                { en: "Go", zh: "å» (åŸå½¢)", hint: "å¤ " },
                { en: "Went", zh: "å» (éå»å¼)", hint: "æº« ã„Š" },
                { en: "Gone", zh: "å» (å®Œæˆå¼)", hint: "å‰›" },
                { en: "Eat", zh: "åƒ (åŸå½¢)", hint: "ä¼Š ã„Š" },
                { en: "Ate", zh: "åƒ (éå»å¼)", hint: "ã„Ÿ ã„Š" },
                { en: "Eaten", zh: "åƒ (å®Œæˆå¼)", hint: "ä¼Š é¨°" },
                { en: "See", zh: "çœ‹ (åŸå½¢)", hint: "æˆ²" },
                { en: "Saw", zh: "çœ‹ (éå»å¼)", hint: "ç´¢" },
                { en: "Seen", zh: "çœ‹ (å®Œæˆå¼)", hint: "ä¿¡" },
                { en: "Buy", zh: "è²· (åŸå½¢)", hint: "æ°" },
                { en: "Bought", zh: "è²· (éå»/å®Œæˆ)", hint: "å ± ã„Š" },
                { en: "Can", zh: "èƒ½å¤  (åŠ©å‹•è©)", hint: "çœ‹" }
            ],
            // Level 9: é«˜ä¸‰ç²¾é€²æ–‡æ³• (Senior High 3)
            level9: [
                { en: "Hypothesis", zh: "å‡è¨­", hint: "æµ· æ€• ã„œ å–œ æ­»" },
                { en: "Metaphor", zh: "éš±å–»", hint: "å¦¹ å¡” ä½›" },
                { en: "Sophisticated", zh: "ç²¾å¯†çš„/è€ç·´çš„", hint: "è˜‡ è² æ­» è¸¢ k ã„Š" },
                { en: "Vulnerable", zh: "æ˜“å—å‚·çš„", hint: "ä½› è¨¥ æƒ¹ ä¼¯" },
                { en: "Psychology", zh: "å¿ƒç†å­¸", hint: "è³½ å¡ æ¨‚ å±…" },
                { en: "Sustainable", zh: "æ°¸çºŒçš„", hint: "è–© æ­» ã„Šã„Ÿ è¨¥ ä¼¯" },
                { en: "Ambiguous", zh: "æ¨¡ç¨œå…©å¯çš„", hint: "å®‰ ç•¢ æ¡‚ é¤“ æ­»" },
                { en: "Coincidence", zh: "å·§åˆ", hint: "å£ å° è¥¿ ç­‰ æ­»" },
                { en: "Inevitable", zh: "ä¸å¯é¿å…çš„", hint: "å›  å…§ ä½› ç‰¹ ä¼¯" },
                { en: "Dilemma", zh: "é€²é€€å…©é›£", hint: "åº• ç´¯ ç½µ" },
                { en: "Simultaneous", zh: "åŒæ™‚çš„", hint: "è³½ æ‘© ã„Šã„Ÿ å°¼ é¤“ æ­»" },
                { en: "Spontaneous", zh: "è‡ªç™¼çš„", hint: "æ­» æ£’ ã„Šã„Ÿ å°¼ é¤“ æ­»" },
                { en: "Intervention", zh: "ä»‹å…¥/å¹²æ¶‰", hint: "å›  ç‰¹ èŠ¬ ç‚«" },
                { en: "Commodity", zh: "å•†å“", hint: "å¯ ç½µ åº• è¸¢" },
                { en: "Diversity", zh: "å¤šæ¨£æ€§", hint: "å¸¶ ä½› è‰² è¸¢" }
            ],
            // Level 10: å­¸æ¸¬/å¤šç›Šå¿…å­¸ (GSAT/TOEIC)
            level10: [
                { en: "Comprehensive", zh: "ç¶œåˆçš„/è©³ç›¡çš„", hint: "åº· æ™® ç‘ äº¨ è¥¿ å¤«" },
                { en: "Distinguish", zh: "å€åˆ¥", hint: "æ»´ æ­» ä¸ è²´ è¨±" },
                { en: "Characteristic", zh: "ç‰¹å¾µ", hint: "å‡± ç‘ ç‰¹ ç‘ æ­» è¸¢ ã„" },
                { en: "Prominent", zh: "é¡¯è‘—çš„", hint: "æ™® æ‹‰ ç±³ å«© ã„Š" },
                { en: "Negotiate", zh: "è«‡åˆ¤", hint: "å‘¢ è³¼ å–œ ã„Ÿ ã„Š" },
                { en: "Appreciate", zh: "æ„Ÿæ¿€/æ¬£è³", hint: "å™ æ™® ç‘ å–œ ã„Ÿ ã„Š" },
                { en: "Consequently", zh: "çµæœ/å› æ­¤", hint: "åº· è‰² æ˜† é›¢" },
                { en: "Nevertheless", zh: "å„˜ç®¡å¦‚æ­¤", hint: "å…§ ä½› æƒ¹ å‹’ æ­»" },
                { en: "Potential", zh: "æ½›åŠ›", hint: "æ³¢ èˆ” ç§€" },
                { en: "Exaggerate", zh: "èª‡å¼µ", hint: "ä¸€ è‘› ç´® æƒ¹ ç‘ ã„Š" },
                { en: "Acquire", zh: "ç²å¾—/ç¿’å¾—", hint: "å™ å¡Š å…’" },
                { en: "Appropriate", zh: "é©ç•¶çš„", hint: "å™ å©† æ™® ç‘ ã„Ÿ ã„Š" },
                { en: "Efficient", zh: "æœ‰æ•ˆç‡çš„", hint: "ä»¥ è² ç‚« ã„Š" },
                { en: "Representative", zh: "ä»£è¡¨", hint: "ç‘ æ™® ç‘ ä» å¿‘ æ›¿ å¤«" },
                { en: "Component", zh: "æˆåˆ†/é›¶ä»¶", hint: "åº· å‰– å«© ã„Š" }
            ]
        };

        const LEVELS = [
            { id: 'level1', title: '1. æ¯éŸ³åŸºç¤', desc: 'A, E, I, O, U èˆ‡ç°¡å–®å­—', color: 'bg-yellow-400' },
            { id: 'level2', title: '2. æ‹¼è®€ç·´ç¿’', desc: 'C-a-t Cat çµ„åˆéŸ³', color: 'bg-orange-400' },
            { id: 'level3', title: '3. åœ‹å°å–®å­—', desc: 'åŸºç¤ç”Ÿæ´»å­—å½™', color: 'bg-green-400' },
            { id: 'level4', title: '4. åœ‹ä¸­å–®å­—', desc: 'é€²éšé–±è®€å­—å½™', color: 'bg-teal-400' },
            { id: 'level5', title: '5. é«˜ä¸€æ ¸å¿ƒ', desc: 'å­¸è¡“å…¥é–€å­—å½™', color: 'bg-blue-400' },
            { id: 'level6', title: '6. é«˜äºŒé€²éš', desc: 'æ·±åº¦é–±è®€å­—å½™', color: 'bg-indigo-400' },
            { id: 'level7', title: '7. æ—¥å¸¸æœƒè©±', desc: 'ç”Ÿæ´»å¿…å‚™çŸ­èª', color: 'bg-purple-400' },
            { id: 'level8', title: '8. æ–‡æ³•å‹•è©', desc: 'å‹•è©è®ŠåŒ–èˆ‡æ–‡æ³•', color: 'bg-pink-400' },
            { id: 'level9', title: '9. é«˜ä¸‰ç²¾é€²', desc: 'å­¸è¡“èˆ‡æŠ½è±¡æ¦‚å¿µ', color: 'bg-rose-400' },
            { id: 'level10', title: '10. å­¸æ¸¬/å¤šç›Š', desc: 'é«˜é »è€ƒè©¦å¿…å‚™å–®å­—', color: 'bg-stone-500' }
        ];

        // ==========================================
        //  æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (App Logic)
        // ==========================================

        let state = {
            view: 'home',      // home, game, result
            currentLevelId: '',
            questions: [],     // æœ¬å±€é¡Œç›®
            currentIndex: 0,
            score: 0,
            status: 'idle',    // idle, listening, evaluating
            transcript: ''
        };

        // èªéŸ³åˆæˆ (TTS)
        function speak(text, rate = 0.8) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US';
            u.rate = rate; // é€Ÿåº¦ç¨æ…¢é©åˆå­¸ç¿’
            window.speechSynthesis.speak(u);
        }

        // èªéŸ³è¾¨è­˜ (STT)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                state.status = 'listening';
                render();
            };
            
            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                state.transcript = result;
                evaluate(result);
            };
            
            recognition.onerror = (e) => {
                console.error(e);
                state.status = 'idle';
                state.transcript = 'ç„¡æ³•è¾¨è­˜ï¼Œè«‹å†è©¦ä¸€æ¬¡';
                render();
            };
            
            recognition.onend = () => {
                if (state.status === 'listening') {
                    state.status = 'idle';
                    render();
                }
            };
        }

        // æ ¸å¿ƒé‚è¼¯ï¼šè©•ä¼°ç­”æ¡ˆ
        function evaluate(userSay) {
            state.status = 'evaluating';
            const currentQ = state.questions[state.currentIndex];
            const target = currentQ.en.toLowerCase();
            const input = userSay.toLowerCase();
            
            // å¯¬é¬†æ¯”å°ï¼šåªè¦åŒ…å«ç›®æ¨™å­—å³å¯
            const isCorrect = input.includes(target) || target.includes(input);
            
            if (isCorrect) state.score += 10;
            
            // ä¸ç®¡å°éŒ¯ï¼Œéƒ½è¦å”¸æ­£ç¢ºç­”æ¡ˆ
            speak(currentQ.en);

            render();

            // 1.5ç§’å¾Œé€²å…¥ä¸‹ä¸€é¡Œ
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        function nextQuestion() {
            if (state.currentIndex < state.questions.length - 1) {
                state.currentIndex++;
                state.status = 'idle';
                state.transcript = '';
                render();
            } else {
                state.view = 'result';
                render();
                speak("Great job!");
            }
        }

        function startGame(levelId) {
            const allWords = WORD_DATA[levelId];
            // æ¯æ¬¡éš¨æ©Ÿå– 10 é¡Œï¼Œè‹¥å–®å­—åº«å¤ å¤§å‰‡ä¸æœƒé‡è¤‡æ„Ÿå¤ªé‡
            // è‹¥è¦å…¨éƒ¨ç·´ç¿’ï¼Œå¯ç§»é™¤ slice
            state.questions = [...allWords].sort(() => 0.5 - Math.random()).slice(0, 10);
            state.currentLevelId = levelId;
            state.currentIndex = 0;
            state.score = 0;
            state.status = 'idle';
            state.transcript = '';
            state.view = 'game';
            render();
            
            // é€²å ´è‡ªå‹•å”¸ç¬¬ä¸€å€‹å­—
            setTimeout(() => speak(state.questions[0].en), 500);
        }

        function goHome() {
            state.view = 'home';
            render();
        }

        // ==========================================
        //  ä»‹é¢æ¸²æŸ“ (UI Render)
        // ==========================================

        function render() {
            const app = document.getElementById('app');
            let html = '';

            if (state.view === 'home') {
                html = `
                    <div class="w-full p-6 pb-20 fade-in">
                        <header class="mb-8 text-center">
                            <h1 class="text-3xl font-black text-indigo-600 mb-1">English Master</h1>
                            <p class="text-sm text-slate-500">ç™¼éŸ³ãƒ»è½åŠ›ãƒ»å–®å­—ç‰¹è¨“</p>
                        </header>
                        
                        <div class="grid gap-4">
                            ${LEVELS.map(lvl => `
                                <button onclick="startGame('${lvl.id}')" class="relative overflow-hidden rounded-2xl shadow-md transition-transform active:scale-95 text-left">
                                    <div class="${lvl.color} p-4 text-white">
                                        <div class="font-bold text-lg">${lvl.title}</div>
                                        <div class="text-xs opacity-90">${lvl.desc}</div>
                                    </div>
                                    <div class="absolute right-4 top-1/2 -translate-y-1/2 text-white/30">
                                        <i data-lucide="play" class="w-12 h-12 fill-current"></i>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (state.view === 'game') {
                const q = state.questions[state.currentIndex];
                const isEvaluating = state.status === 'evaluating';
                const isListening = state.status === 'listening';
                
                // åˆ¤æ–·æ˜¯å¦é¡¯ç¤ºçµæœé¡è‰²
                let cardClass = "bg-white border-4 border-slate-100";
                let feedbackHtml = "";
                
                if (isEvaluating) {
                    const isCorrect = state.transcript.toLowerCase().includes(q.en.toLowerCase());
                    cardClass = isCorrect ? "bg-green-50 border-4 border-green-200" : "bg-red-50 border-4 border-red-200";
                    feedbackHtml = isCorrect 
                        ? `<div class="absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none correct-anim">
                             <span class="text-8xl">ğŸ‰</span>
                           </div>`
                        : `<div class="absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none shake">
                             <span class="text-8xl">ğŸ’ª</span>
                           </div>`;
                }

                html = `
                    <div class="w-full h-full flex flex-col p-6 fade-in relative">
                        <!-- Top Bar -->
                        <div class="flex justify-between items-center mb-6">
                            <button onclick="goHome()" class="p-2 rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200">
                                <i data-lucide="arrow-left"></i>
                            </button>
                            <div class="font-bold text-slate-400">
                                ${state.currentIndex + 1} / ${state.questions.length}
                            </div>
                            <div class="bg-yellow-100 text-yellow-600 px-3 py-1 rounded-full font-bold text-sm">
                                ${state.score} åˆ†
                            </div>
                        </div>

                        <!-- Card -->
                        <div class="flex-1 flex flex-col items-center justify-center relative ${cardClass} rounded-3xl shadow-xl transition-colors duration-300 p-8 mb-8">
                            ${feedbackHtml}
                            
                            <div class="text-2xl text-slate-500 font-medium mb-2">${q.zh}</div>
                            <div class="text-5xl font-black text-slate-800 mb-6 text-center leading-tight break-all">
                                ${q.en}
                            </div>
                            
                            <!-- è«§éŸ³æç¤º (é‡é»åŠŸèƒ½) -->
                            <div class="bg-indigo-50 text-indigo-600 px-6 py-3 rounded-xl text-lg font-bold border border-indigo-100 mb-8">
                                <span class="text-xs text-indigo-300 mr-2">è®€éŸ³</span>${q.hint}
                            </div>

                            <!-- è¾¨è­˜çµæœé¡¯ç¤º -->
                            <div class="h-8 text-center mb-4">
                                ${isListening ? '<span class="text-red-500 animate-pulse font-bold">è†è½ä¸­...</span>' : ''}
                                ${state.transcript ? `<span class="text-slate-400 text-sm">ä½ èªªäº†: "${state.transcript}"</span>` : ''}
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="flex items-center justify-center gap-6 mb-8">
                            <button onclick="speak('${q.en}')" class="w-16 h-16 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center active:bg-slate-200 transition-colors">
                                <i data-lucide="volume-2" class="w-8 h-8"></i>
                            </button>

                            ${SpeechRecognition ? `
                                <button onclick="recognition.start()" class="w-24 h-24 rounded-full bg-indigo-600 text-white flex items-center justify-center shadow-lg shadow-indigo-200 active:scale-95 transition-all ${isListening ? 'pulse-mic' : ''}">
                                    <i data-lucide="mic" class="w-10 h-10"></i>
                                </button>
                            ` : `
                                <div class="text-red-400 text-xs text-center w-24">æ­¤ç€è¦½å™¨ä¸æ”¯æ´éŒ„éŸ³</div>
                            `}
                        </div>
                        
                        <div class="text-center text-xs text-slate-300">
                            é»æ“Šéº¥å…‹é¢¨å”¸å‡ºå–®å­—
                        </div>
                    </div>
                `;
            } else if (state.view === 'result') {
                html = `
                    <div class="w-full h-full flex flex-col items-center justify-center p-8 fade-in text-center">
                        <div class="text-8xl mb-4 animate-bounce">ğŸ†</div>
                        <h2 class="text-3xl font-black text-slate-800 mb-2">æ¸¬é©—å®Œæˆï¼</h2>
                        <p class="text-slate-500 mb-8">å¤ªæ£’äº†ï¼Œç¹¼çºŒä¿æŒï¼</p>
                        
                        <div class="bg-white border-2 border-slate-100 w-full rounded-2xl p-6 mb-8 shadow-sm">
                            <div class="text-slate-400 text-sm mb-1">ç¸½å¾—åˆ†</div>
                            <div class="text-6xl font-black text-indigo-500">${state.score}</div>
                        </div>
                        
                        <button onclick="goHome()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition-all">
                            å›åˆ°ä¸»é¸å–®
                        </button>
                    </div>
                `;
            }

            app.innerHTML = html;
            lucide.createIcons();
        }

        // Init
        render();

    </script>
</body>
</html>